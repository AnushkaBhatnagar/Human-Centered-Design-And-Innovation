<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Closet - Wardrobe</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .filters-bar {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .filter-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md) var(--spacing-sm) 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.95rem;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .item-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-base);
            cursor: pointer;
        }

        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--bg-tertiary);
        }

        .item-details {
            padding: var(--spacing-md);
        }

        .item-name {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            font-size: 0.95rem;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .item-type {
            text-transform: capitalize;
        }

        .wear-count {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 600;
        }

        .view-toggle {
            display: flex;
            gap: var(--spacing-xs);
            background: var(--bg-tertiary);
            padding: 0.25rem;
            border-radius: var(--radius-md);
        }

        .view-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-secondary);
            transition: all var(--transition-base);
        }

        .view-btn.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }

        .items-list {
            display: none;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .items-list.active {
            display: flex;
        }

        .items-grid.active {
            display: grid;
        }

        .item-list-card {
            display: flex;
            gap: var(--spacing-lg);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: all var(--transition-base);
            cursor: pointer;
        }

        .item-list-card:hover {
            box-shadow: var(--shadow-md);
        }

        .item-list-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        .item-list-details {
            flex: 1;
        }

        .item-list-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--spacing-sm);
        }

        .item-list-name {
            font-size: 1.125rem;
            font-weight: 700;
        }

        .color-badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .item-list-meta {
            display: flex;
            gap: var(--spacing-lg);
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: var(--spacing-sm);
        }

        .season-tags {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .season-tag {
            padding: 0.25rem 0.5rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
        }

        .empty-closet {
            text-align: center;
            padding: var(--spacing-2xl) var(--spacing-xl);
            color: var(--text-tertiary);
        }

        .empty-closet svg {
            width: 80px;
            height: 80px;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <path d="M16 4L4 10V22L16 28L28 22V10L16 4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                <path d="M16 16L4 10M16 16L28 10M16 16V28" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
            <span>Wardrobe</span>
        </div>
        <ul class="nav-links">
            <li>
                <a href="index.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    Dashboard
                </a>
            </li>
            <li class="active">
                <a href="closet.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="3" y="2" width="14" height="16" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M10 2V18M6 6H8M12 6H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    My Closet
                </a>
            </li>
            <li>
                <a href="add-item.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M10 7V13M7 10H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    Add Item
                </a>
            </li>
            <li>
                <a href="analytics.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M3 14L7 10L11 14L17 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="7" cy="10" r="1.5" fill="currentColor"/>
                        <circle cx="11" cy="14" r="1.5" fill="currentColor"/>
                        <circle cx="17" cy="8" r="1.5" fill="currentColor"/>
                    </svg>
                    Analytics
                </a>
            </li>
            <li>
                <a href="recommendations.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 3L12 8L17 8.5L13.5 12L14.5 17L10 14.5L5.5 17L6.5 12L3 8.5L8 8L10 3Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                    </svg>
                    Outfit Ideas
                </a>
            </li>
            <li>
                <a href="shopping.html">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6 6L4 2H16L14 6M6 6H14M6 6L5 18H15L14 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Shopping
                </a>
            </li>
        </ul>
        <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <button onclick="handleLogout()" style="display: flex; align-items: center; gap: 0.75rem; width: 100%; padding: 0.75rem 1rem; background: none; border: none; color: #ef4444; font-weight: 500; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s; text-align: left;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M7 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3"/>
                    <polyline points="13 14 17 10 13 6"/>
                    <line x1="17" y1="10" x2="7" y2="10"/>
                </svg>
                Logout
            </button>
        </div>
    </nav>

    <main class="main-content">
        <header class="page-header">
            <div>
                <h1>My Closet</h1>
                <p class="subtitle">Browse and manage your wardrobe items</p>
            </div>
            <div class="header-actions">
                <a href="add-item.html" class="btn-primary">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M10 7V13M7 10H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    Add Item
                </a>
            </div>
        </header>

        <div class="filters-bar">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M14 14L18 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Search items...">
            </div>

            <div class="filter-group">
                <span class="filter-label">Type:</span>
                <select id="typeFilter" class="select-simple">
                    <option value="">All</option>
                    <option value="top">Tops</option>
                    <option value="bottom">Bottoms</option>
                    <option value="dress">Dresses</option>
                    <option value="outerwear">Outerwear</option>
                    <option value="shoes">Shoes</option>
                    <option value="accessory">Accessories</option>
                </select>
            </div>

            <div class="filter-group">
                <span class="filter-label">Sort:</span>
                <select id="sortBy" class="select-simple">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name (A-Z)</option>
                    <option value="mostWorn">Most Worn</option>
                    <option value="leastWorn">Least Worn</option>
                </select>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" data-view="grid">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <rect x="3" y="3" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="12" y="3" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="3" y="12" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="12" y="12" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
                <button class="view-btn" data-view="list">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M3 5H17M3 10H17M3 15H17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </div>

        <div id="itemsContainer">
            <div class="items-grid active" id="gridView"></div>
            <div class="items-list" id="listView"></div>
        </div>
    </main>

    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script>
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('wardrobe_user_name');
                localStorage.removeItem('wardrobe_desktop_onboarding_completed');
                window.location.href = 'index.html';
            }
        }

        let currentView = 'grid';
        let allItems = [];

        document.addEventListener('DOMContentLoaded', () => {
            allItems = Storage.getItems();
            renderItems(allItems);
            initializeFilters();
            initializeViewToggle();
        });

        function initializeFilters() {
            const searchInput = document.getElementById('searchInput');
            const typeFilter = document.getElementById('typeFilter');
            const sortBy = document.getElementById('sortBy');

            searchInput.addEventListener('input', applyFilters);
            typeFilter.addEventListener('change', applyFilters);
            sortBy.addEventListener('change', applyFilters);
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value;
            const type = document.getElementById('typeFilter').value;
            const sort = document.getElementById('sortBy').value;

            let filtered = App.filterItems(allItems, { search, type });
            filtered = App.sortItems(filtered, sort);

            renderItems(filtered);
        }

        function initializeViewToggle() {
            const viewButtons = document.querySelectorAll('.view-btn');
            viewButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentView = btn.dataset.view;
                    viewButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    toggleView();
                });
            });
        }

        function toggleView() {
            const gridView = document.getElementById('gridView');
            const listView = document.getElementById('listView');

            if (currentView === 'grid') {
                gridView.classList.add('active');
                listView.classList.remove('active');
            } else {
                gridView.classList.remove('active');
                listView.classList.add('active');
            }

            renderItems(allItems);
            applyFilters();
        }

        function renderItems(items) {
            const gridView = document.getElementById('gridView');
            const listView = document.getElementById('listView');

            if (items.length === 0) {
                const emptyState = `
                    <div class="empty-closet">
                        <svg viewBox="0 0 64 64" fill="none">
                            <rect x="12" y="16" width="40" height="36" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M32 16V52M20 24H24M40 24H44" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <h3>Your closet is empty</h3>
                        <p>Start adding items to build your digital wardrobe</p>
                        <a href="add-item.html" class="btn-primary" style="margin-top: 1rem;">Add Your First Item</a>
                    </div>
                `;
                gridView.innerHTML = emptyState;
                listView.innerHTML = '';
                return;
            }

            // Grid view
            gridView.innerHTML = items.map(item => `
                <div class="item-card" onclick="viewItem('${item.id}')">
                    <img src="${item.image}" alt="${item.name}" class="item-image">
                    <div class="item-details">
                        <div class="item-name">${item.name}</div>
                        <div class="item-meta">
                            <span class="item-type">${item.type}</span>
                            <span class="wear-count">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 2L9.5 6L14 6.5L11 10L11.5 14L8 12L4.5 14L5 10L2 6.5L6.5 6L8 2Z" fill="currentColor"/>
                                </svg>
                                ${item.wearCount || 0}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');

            // List view
            listView.innerHTML = items.map(item => `
                <div class="item-list-card" onclick="viewItem('${item.id}')">
                    <img src="${item.image}" alt="${item.name}" class="item-list-image">
                    <div class="item-list-details">
                        <div class="item-list-header">
                            <h3 class="item-list-name">${item.name}</h3>
                            <div class="color-badge" style="background: ${item.color};"></div>
                        </div>
                        <div class="item-list-meta">
                            <span><strong>Type:</strong> ${item.type}</span>
                            <span><strong>Worn:</strong> ${item.wearCount || 0} times</span>
                            <span><strong>Added:</strong> ${App.formatDate(item.purchaseDate, 'short')}</span>
                        </div>
                        ${item.season && item.season.length > 0 ? `
                            <div class="season-tags">
                                ${item.season.map(s => `<span class="season-tag">${s}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function viewItem(id) {
            const item = allItems.find(i => i.id === id);
            if (!item) return;

            const modalContent = `
                <img src="${item.image}" style="width: 100%; border-radius: 0.5rem; margin-bottom: 1rem;" alt="${item.name}">
                <div style="display: grid; gap: 0.75rem;">
                    <div><strong>Type:</strong> ${item.type}</div>
                    <div><strong>Color:</strong> <span style="display: inline-block; width: 20px; height: 20px; background: ${item.color}; border-radius: 50%; vertical-align: middle; border: 1px solid #ddd;"></span></div>
                    ${item.season && item.season.length > 0 ? `<div><strong>Seasons:</strong> ${item.season.join(', ')}</div>` : ''}
                    <div><strong>Times Worn:</strong> ${item.wearCount || 0}</div>
                    <div><strong>Added:</strong> ${App.formatDate(item.purchaseDate, 'long')}</div>
                    ${item.notes ? `<div><strong>Notes:</strong> ${item.notes}</div>` : ''}
                </div>
                <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                    <button class="btn-primary" onclick="editItem('${item.id}')" style="flex: 1;">Edit</button>
                    <button class="btn-secondary" onclick="deleteItem('${item.id}')" style="flex: 1; background: #ef4444; color: white;">Delete</button>
                </div>
            `;

            App.createModal(modalContent, { title: item.name });
        }

        function editItem(id) {
            App.showToast('Edit functionality coming soon!', 'info');
        }

        function deleteItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                Storage.deleteItem(id);
                allItems = Storage.getItems();
                renderItems(allItems);
                applyFilters();
                App.showToast('Item deleted', 'success');
                
                // Close modal
                document.querySelector('.modal-overlay')?.remove();
            }
        }
    </script>
</body>
</html>
